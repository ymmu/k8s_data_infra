# Building a data infra on k8s

### 작업 배경
- 데이터 엔지니어링 작업을 하면서 k8s로 관리되던 데이터 인프라는 sre팀에 의존하여 관리해왔으나, 실무에서는 데이터 엔지니어도 k8s에 대한 이해도도 요구하는 상황
- k8s 이해도를 높여 인프라 구축 부분에도 타팀에 의존도를 낮추고, 다양한 데이터 엔지니어링 시도에 좀 더 자유로워질 수 있고자 함..! 

### 목표 (원하는 아웃풋)
조금씩 추가/수정될 듯.
1. k8s에 데이터 인프라 구축
    - 현 목표는 인프라 **"구축"** 에 있으므로.. 고도화는 나중에 

    - (기본) 람다 아키텍처와 같은 배치/스트리밍/서빙 작업을 모두 할 수 있는 환경 (airflow, kafka, spark, bigquery,...)
    - 통합 거버넌스 환경 (datahub,,)
    - 엔지니어링이 주업무가 아닌 데이터 관련팀의 작업을 도울 수 있는 환경 (dbt ?)




### Steps
러프한 계획. 작업하면서 추가/수정될 듯.
1. k8s 기본 지식, helm 실습 
2. 인프라 초안 설계
3. 인프라 구축 나눠서 작업
4. 간단한 테스트용 유사? 서비스 인프라 생성 (스트리밍, 배치 작업 테스트)
  
---
### 간단한 일지..
- 작업을 멈췄다 재게하면 기억이 잘 안나서 짧게 남겨보기..


**20240725월**
- 여러 가지 일로 바빠 프로젝트 작업을 못 했다.ㅠ
- 그래도 중간중간 쿠버네티스로 이것저것 설치해보긴 했는데, 몇 가지 문제가 있었다.
1. **오퍼레이터 넌 도대체 뭐냐**
    - 찾아보다 요즘은 오퍼레이터를 이용해서 구축을 많이 하는 것 같다. 예를 들어 kafka를 설치한다 하면 kafka operator를 설치하고, 이 오퍼레이터를 이용해서 kafka 운영을 한다. k8s의 crd를 이용해서 툴의 운영을 자동화해서 관리 포인트를 줄인다는 목적으로 보인다.
    - 근데 quick start를 이용해 설치까지는 좋았는데, 내가 커스터마이징 하는게 너무 힘든 것이다. crd를 사용하다보니..
    - 게다가 helm 구조가 익숙치가 않아서 이해도 힘들고..
    - 그래서 내 공부집사인 gpt에게 질문 집중포격 + kafka 오퍼레이터 helm 차트를 뜯어보면서, 
        - 쿠버네티스의 crds, 오퍼레이터가 뭔지
        - helm으로 어떻게 오퍼레이터가 작성되는지(컨트롤러 부분은 템플릿에 작성.기본 오브젝트로 작성함)
        - crd 작성하고 보는 법
        - cr 작성하는 법 
    - 등등을 어느정도 이해하게 되었다. 맨땅에 작성하라고 하면 좀 힘들지만 작성된거 볼 정도는 된거 같다.
2. **helm 차트 보기 힘들다**
    - 익숙치가 않다. go 템플릿도 어쨋든 언어이니 보면 무슨 내용인지 알 수 있긴 한데 그래도 yaml 구조 자체가 보기가 힘들다.

- **결론** 
    - 오퍼레이터도 결국 k8s 기본 오브젝트들을 잘 이해하고 있어야 하고, helm 차트에 익숙해지는 등의 기본이 되어 있어야 저런 것도 접했을 때 빠르게 이해가 되겠거니 생각이 들었다. 
    - **그래서 책 실습을 얼른 마쳐서 모든 내용을 어느정도 숙지하자는 생각이 들었다.**
    - 근데 확실히 삽질이 머리에 제일 잘 각인되긴 한다. 힘들어서 그렇지. ㅎㅎ
- **한 일**
    - storage 부분 정리 -1
