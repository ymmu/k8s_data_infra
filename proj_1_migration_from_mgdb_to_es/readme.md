# Project #1 Migration from MongoDB to ES 
  
---

## 0. 작업 배경
- **몽고디비에 있는 상품을 검색속도를 높이기 위한 작업을 한다면 무엇을 해야할까?** 해당 작업에 대해 의뢰(?) 가 들어왔다 가정했을 때, 해당 작업을 할 때 구축은 얼마나 걸리고, 작업 중에 무슨 문제에 당면할지 궁금해졌음..ㅎ

- **몽고디비 튜닝작업은 제외한다.** 처음엔 몽고디비 자체의 튜닝을 고려해볼 수 있을 것이다. 그치만 일단 이 부분은 이미 고려했으나 더 큰 발전이 없어서, 아예 다른 검색엔진으로 갈아타는 방향으로 간다 가정하자.

- **RDS에는 넣지 않을 것이다.** RDS에 데이터를 넣으려면 상품데이터 구조를 보고 정규화를 해야할 수도 있을것 같은데, 시간이 많이 들 것 같다. 처음 NoSQL 에 데이터를 집어넣은 이유가 있을 것 같다. NoSQL에 넣은 의도는 모르고, 실제 데이터도 보지 못 했다. 그러나, 나의 추측으로 초기에 서비스를 만들 때 빠르게 프로토타입을 만들면서 RDS에 정규화하고 뭐하는 작업을 스킵 + 상품데이터 구조변경에 유연하게 대응하기 위해 NoSQL을 선택하지 않았나 싶다...

- **ES로 검색엔진을 옮겨보자.** 몽고디비와 비슷한 nosql 이면서 검색엔진 특화된 디비가 ES이다. 많은 벤치마킹 결과에서 Elasticsearch가 대량 데이터를 더 빠르게 검색한다고 검증이 되어 있다. 데이터 구조도 json 이고, 마이그레이션도 비교적 어려워보이지 않는다.

- 몽고디비에 들어있는 상품이 어떻게 들어있는지 전혀 모르니 쩝...일단 몽고와 es 둘다에 같은 데이터를 넣고 어떤 경우에 데이터 검색속도 차이가 벌어지는지 보는 것도 좋을 것 같다. es를 계속 최적화 해가면서 검색속도 차이가 많이 벌어질 수 있는지도 확인해보면 재밌을 것 같다.
  
- 상황에 대한 추가 설정
  - mongodb 는 백업본을 주기적으로 생성한다.
  - 마이그레이션해야 하는 데이터는 충분히 큰 데이터이다.
  

## 1. 작업 목표
- mongodb -> es 로 fake 상품 데이터 마이그레이션 & 검색 최적화 작업
    - es 검색결과는 1초 이하로 리턴될 수 있도록 한다.
    - es 검색결과는 몽고디비 검색결과보다 빨라야 한다.

## 2. 작업순서
1. 필요한 data infra 구축 (on k8s)
    - MongoDB, ES
        - MongoDB에 데이터 넣기
    - kafka, akhq, kafka-connect, schema registry
    - jenkins (values 변경사항 자동반영🫠)

2. 마이그레이션 테스트
    - 백업데이터로 initial data 먼저 적재
    - kafka connector 등으로 최신데이터 싱크작업 
    - 작은데이터로 먼저 잘 동작하는지 확인 -> 큰 데이터로 테스트

3. ES 최적화
    - 테스트를 통해 인덱스 라이프사이클 / 토크나이저 / 애널라이저 / 매핑 .. 등 설정 최적화.

4. 문서작업
    - 인프라 운영시 이슈
    - 검색속도 테스트 결과 ...
    - 배운 점과 보완할 점..
